/*!
 * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.
 */

import {assert} from '@ciscospark/test-helper-chai';
import MeetingCollection from '@webex/plugin-meetings/src/meetings/collection';
import uuid from 'uuid';

describe('plugin-meetings', () => {
  describe('meetings collection', () => {
    let uuid1;
    let uuid2;
    beforeEach(() => {
      uuid1 = uuid.v4();
      uuid2 = uuid.v4();
      MeetingCollection.meetings = {};
    });
    describe('#get', () => {
      beforeEach(() => {
        MeetingCollection.meetings.test = 'test';
        MeetingCollection.meetings.test2 = 'test2';
      });
      it('should get the meeting', () => {
        assert.equal(MeetingCollection.get('test'), 'test');
      });
    });
    describe('#set', () => {
      it('should set the meeting', () => {
        assert.equal(Object.keys(MeetingCollection.meetings).length, 0);
        MeetingCollection.set({id: uuid1});
        assert.equal(Object.keys(MeetingCollection.meetings).length, 1);
      });
    });
    describe('#remove', () => {
      beforeEach(() => {
        MeetingCollection.meetings.test = {id: uuid1};
      });
      it('should get the meeting', () => {
        assert.equal(Object.keys(MeetingCollection.meetings).length, 1);
        assert.deepEqual(MeetingCollection.remove('test'), {id: uuid1});
        assert.equal(Object.keys(MeetingCollection.meetings).length, 0);
      });
    });
    describe('#getAll', () => {
      beforeEach(() => {
        MeetingCollection.meetings.test = {id: uuid1};
        MeetingCollection.meetings.test2 = {id: uuid2};
      });
      it('should get all the meeting', () => {
        assert.equal(Object.keys(MeetingCollection.getAll()).length, 2);
        assert.deepEqual(Object.keys(MeetingCollection.getAll()), ['test', 'test2']);
      });
      describe('with filters', () => {
        beforeEach(() => {
          MeetingCollection.meetings.test = {id: uuid1, active: true};
          MeetingCollection.meetings.test2 = {id: uuid2, active: false};
        });
        it('should get all the active meetings', () => {
          assert.equal(Object.keys(MeetingCollection.meetings).length, 2);
          assert.deepEqual(Object.keys(MeetingCollection.getAll({active: true})), ['test']);
        });
      });
    });
    describe('#getByKey', () => {
      beforeEach(() => {
        MeetingCollection.meetings.test = {value: 'test', id: uuid1};
        MeetingCollection.meetings.test2 = {value: 'test2', id: uuid2};
      });
      it('should get the meeting by key', () => {
        assert.equal(Object.keys(MeetingCollection.meetings).length, 2);
        assert.deepEqual(MeetingCollection.getByKey('value', 'test'), {value: 'test', id: uuid1});
      });
    });
  });
});
