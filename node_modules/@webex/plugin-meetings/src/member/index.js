/*!
 * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.
 */
import {
  MEETINGS,
  IN_LOBBY,
  NOT_IN_MEETING,
  IN_MEETING
} from '../constants';

import MemberUtil from './util.js';

/**
 * @class Member
 */
export default class Member {
  namespace = MEETINGS;

  /**
   * @param {Object} participant - the locus participant
   * @param {Object} options - optional constructor params
   * @returns {Member}
   * @memberof Member
   */
  constructor(participant, options = {}) {
    this.participant = null;
    this.id = null;
    this.name = null;
    this.isAudioMuted = null;
    this.isVideoMuted = null;
    this.isSelf = null;
    this.isHost = null;
    this.isGuest = null;
    this.isInLobby = null;
    this.isInMeeting = null;
    this.isNotAdmitted = null;
    this.isContentSharing = null;
    this.status = null;
    this.isDevice = null;
    this.isUser = null;
    this.associatedUser = null;
    this.isRecording = null;
    // TODO: more participant types
    this.processParticipant(participant);
    this.processParticipantOptions(participant, options);
  }

  /**
   * set all the participant values extracted directly from locus participant
   * @param {Object} participant the locus participant object
   * @returns {undefined}
   * @memberof Member
   */
  processParticipant(participant) {
    this.participant = participant;
    if (participant) {
      this.id = MemberUtil.extractId(participant);
      this.name = MemberUtil.extractName(participant);
      this.isAudioMuted = MemberUtil.isAudioMuted(participant);
      this.isVideoMuted = MemberUtil.isVideoMuted(participant);
      this.isRecording = MemberUtil.isRecording(participant);
      this.isGuest = MemberUtil.isGuest(participant);
      this.isUser = MemberUtil.isUser(participant);
      this.isDevice = MemberUtil.isDevice(participant);
      this.processStatus(participant);
      // must be done last
      this.isNotAdmitted = MemberUtil.isNotAdmitted(participant, this.isGuest, this.status);
    }
  }

  /**
   * Use the members options and participant values to set on the member
   * @param {Object} participant the locus participant object
   * @param {Object} options the passed in options, what was set on members
   * @returns {undefined}
   * @memberof Member
   */
  processParticipantOptions(participant, options) {
    if (participant && options) {
      this.processIsSelf(participant, options.selfId);
      this.processIsHost(participant, options.hostId);
      this.processIsContentSharing(participant, options.contentSharingId);
    }
  }

  /**
   * set the status on member object
   * @param {Object} participant the locus participant object
   * @returns {undefined}
   * @memberof Member
   */
  processStatus(participant) {
    this.status = MemberUtil.extractStatus(participant);
    switch (this.status) {
      case IN_LOBBY:
        this.isInLobby = true;
        this.isInMeeting = false;
        break;
      case IN_MEETING:
        this.isInLobby = false;
        this.isInMeeting = true;
        break;
      case NOT_IN_MEETING:
        this.isInLobby = false;
        this.isInMeeting = false;
        break;
      default:
        this.isInLobby = false;
        this.isInMeeting = false;
    }
  }

  /**
   * set the isContentSharing on member
   * @param {Boolean} flag
   * @returns {undefined}
   * @memberof Member
   */
  setIsContentSharing(flag) {
    this.isContentSharing = flag;
  }

  /**
   * set the isHost on member
   * @param {Boolean} flag
   * @returns {undefined}
   * @memberof Member
   */
  setIsHost(flag) {
    this.isHost = flag;
  }

  /**
   * set the isSelf on member
   * @param {Boolean} flag
   * @returns {undefined}
   * @memberof Member
   */
  setIsSelf(flag) {
    this.isSelf = flag;
  }

  /**
   * determine if this member is content sharing
   * @param {Object} participant
   * @param {String} sharingId
   * @returns {undefined}
   * @memberof Member
   */
  processIsContentSharing(participant, sharingId) {
    if (MemberUtil.isUser(participant)) {
      this.isContentSharing = MemberUtil.isSame(participant, sharingId);
    }
    else if (MemberUtil.isDevice(participant)) {
      this.isContentSharing = MemberUtil.isAssociatedSame(participant, sharingId);
    }
  }

  /**
   * determine if this member is the self
   * @param {Object} participant
   * @param {String} selfId
   * @returns {undefined}
   * @memberof Member
   */
  processIsSelf(participant, selfId) {
    if (MemberUtil.isUser(participant)) {
      this.isSelf = MemberUtil.isSame(participant, selfId);
    }
    else if (MemberUtil.isDevice(participant)) {
      this.isSelf = MemberUtil.isAssociatedSame(participant, selfId);
      this.associatedUser = selfId;
    }
  }

  /**
   * determine if this member is the host
   * @param {Object} participant
   * @param {String} hostId
   * @returns {undefined}
   * @memberof Member
   */
  processIsHost(participant, hostId) {
    if (MemberUtil.isUser(participant)) {
      this.isHost = MemberUtil.isSame(participant, hostId);
    }
    else if (MemberUtil.isDevice(participant)) {
      this.isHost = MemberUtil.isAssociatedSame(participant, hostId);
    }
  }
}
