{"version":3,"sources":["stateless-spark-plugin.js"],"names":["sparks","StatelessSparkPlugin","namespace","getNamespace","toLowerCase","spark","config","logger","get","attrs","options","parent","Error","collection","set","request","upload","readonly","prototype","AmpEvents"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA,IAAMA,SAAS,uBAAf;;AAEA;;;IAGqBC,oB;;;;AACnB;;;;;wBAKa;AACX,UAAIC,YAAY,KAAKC,YAAL,GAAoB,KAAKA,YAAL,EAApB,GAA0C,KAAKD,SAA/D;AACA,UAAIA,SAAJ,EAAe;AACbA,oBAAYA,UAAUE,WAAV,EAAZ;AACA,eAAO,KAAKC,KAAL,CAAWC,MAAX,CAAkBJ,SAAlB,CAAP;AACD;AACD,aAAO,KAAKG,KAAL,CAAWC,MAAlB;AACD;;AAED;;;;;;;wBAIa;AACX,aAAO,KAAKD,KAAL,CAAWE,MAAlB;AACD;;AAED;;;;;;;wBAIY;AACV,aAAOP,OAAOQ,GAAP,CAAW,IAAX,CAAP;AACD;AAGD;;;;;;;;;;;AAUA;;;;;;;AAOA,kCAAsC;AAAA,QAA1BC,KAA0B,uEAAlB,EAAkB;AAAA,QAAdC,OAAc,uEAAJ,EAAI;AAAA;;AAAA;;AACpC,QAAIL,QAAQI,MAAMJ,KAAN,IAAeK,QAAQC,MAAnC;AACA,QAAI,CAACN,KAAL,EAAY;AACV,YAAM,IAAIO,KAAJ,CAAU,oGAAV,CAAN;AACD;;AAED,WAAOP,MAAMM,MAAN,IAAgBN,MAAMQ,UAA7B,EAAyC;AACvCR,cAAQA,MAAMM,MAAN,IAAgBN,MAAMQ,UAA9B;AACD;AACDb,WAAOc,GAAP,CAAW,IAAX,EAAiBT,KAAjB;AACD;;AAED;;;;;;;;;;8BAMiB;AAAA;;AACf,aAAO,eAAKA,KAAL,EAAWU,OAAX,yBAAP;AACD;;AAED;;;;;;;;;6BAMgB;AAAA;;AACd,aAAO,gBAAKV,KAAL,EAAWW,MAAX,0BAAP;AACD;;;0EAhDAC,wB;;;WASO,I;;;kBAxCWhB,oB;;;AAkFrB,sBAAcA,qBAAqBiB,SAAnC,EAA8CC,yBAA9C","file":"stateless-spark-plugin.js","sourcesContent":["import {readonly} from 'core-decorators';\nimport AmpEvents from 'ampersand-events';\n\n// hold onto weak references to parent' Sparks to help avoid retain cycles\nconst sparks = new WeakMap();\n\n/**\n * Base plugin class. Doesn't depend on Ampersand State\n */\nexport default class StatelessSparkPlugin {\n  /**\n   * The config for this plugin's namespace. If no namespace has been set\n   * returns all of spark's config.\n   * @type {Object}\n   */\n  get config() {\n    let namespace = this.getNamespace ? this.getNamespace() : this.namespace;\n    if (namespace) {\n      namespace = namespace.toLowerCase();\n      return this.spark.config[namespace];\n    }\n    return this.spark.config;\n  }\n\n  /**\n   * A reference to the spark logger.\n   * @type {Logger}\n   */\n  get logger() {\n    return this.spark.logger;\n  }\n\n  /**\n   * A reference to the main sdk instance\n   * @type {SparkCore}\n   */\n  get spark() {\n    return sparks.get(this);\n  }\n\n  @readonly\n  /**\n   * Mostly here for compatibility with legacy SparkPlugins.\n   * StatelessSparkPlugins will never have a state other than ready, however, if\n   * we implement stateful SparkPlugins as es6 classes, they may have the option\n   * to have ready be false\n   * @private\n   * @type {boolean}\n   */\n  ready = true;\n\n  /**\n   * Constructor. One of attrs.spark or options.parent is required\n   * @param {Object} attrs\n   * @param {SparkCore} [attrs.spark]\n   * @param {Object} options\n   * @param {SparkCore} [options.parent]\n   */\n  constructor(attrs = {}, options = {}) {\n    let spark = attrs.spark || options.parent;\n    if (!spark) {\n      throw new Error('One of `attrs.spark` or `options.parent` must be supplied when initializing a StatelessSparkPlugin');\n    }\n\n    while (spark.parent || spark.collection) {\n      spark = spark.parent || spark.collection;\n    }\n    sparks.set(this, spark);\n  }\n\n  /**\n   * Proxies to {@link SparkPlugin#spark}'s `request()` method.\n   * @see SparkCore#request\n   * @param {Array<mixed>} args\n   * @returns {Promise}\n   */\n  request(...args) {\n    return this.spark.request(...args);\n  }\n\n  /**\n   * Proxies to {@link SparkPlugin#spark}'s `upload()` method.\n   * @see SparkCore#upload\n   * @param {Array<mixed>} args\n   * @returns {Promise}\n   */\n  upload(...args) {\n    return this.spark.upload(...args);\n  }\n}\n\nObject.assign(StatelessSparkPlugin.prototype, AmpEvents);\n"]}